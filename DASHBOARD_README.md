# داشبورد پروژه - راهنمای استفاده

## مقدمه

داشبورد پروژه یک ابزار پیشرفته برای نمایش و مدیریت پروژه‌های عمرانی است که شامل نمودارهای پروفیل طولی، لایه‌بندی، ابنیه‌ها و آزمایش‌ها می‌باشد.

## ویژگی‌های اصلی

### 1. نمودار پروفیل طولی
- **خط زمین**: نمایش پروفیل طبیعی زمین
- **خط جاده**: نمایش پروفیل طراحی شده جاده
- **محور X**: کیلومتراژ پروژه
- **محور Y**: ارتفاع (متر)

### 2. لایه‌بندی پروژه
- **لایه‌های ثابت**: موازی محور X (مستطیل)
- **لایه‌های متغیر**: متوازی‌الاضلاع
- **رنگ‌بندی بر اساس وضعیت**:
  - خاکستری: شروع نشده
  - زرد: در حال انجام
  - سبز: تکمیل شده

### 3. ابنیه‌ها
- **پل**: خطوط افقی متعدد
- **آبرو**: دایره
- **سایر ابنیه‌ها**: مربع

### 4. آزمایش‌ها
- **پیکسل‌های رنگی**: نمایش درخواست‌های آزمایش
- **تولتیپ**: نمایش جزئیات آزمایش با hover
- **رنگ‌بندی بر اساس وضعیت**:
  - زرد: در انتظار
  - آبی: در حال انجام
  - سبز: تکمیل شده
  - قرمز: رد شده

## نحوه استفاده

### کنترل‌های نمودار
1. **خط جاده**: نمایش/مخفی کردن خط پروفیل جاده
2. **خط زمین**: نمایش/مخفی کردن خط پروفیل زمین
3. **لایه‌ها**: نمایش/مخفی کردن لایه‌های پروژه
4. **ابنیه‌ها**: نمایش/مخفی کردن ابنیه‌ها
5. **آزمایش‌ها**: نمایش/مخفی کردن آزمایش‌ها

### کنترل‌های زوم
- **زوم در**: بزرگنمایی نمودار
- **زوم بر**: کوچک‌نمایی نمودار
- **بازنشانی زوم**: بازگشت به حالت اولیه

### تعامل با نمودار
- **حرکت موس**: نمایش مختصات در کنترل‌ها
- **Hover روی آزمایش‌ها**: نمایش تولتیپ با جزئیات
- **اسکرول**: زوم در/بر
- **درگ**: حرکت در نمودار

## ساختار داده‌ها

### فایل پروفیل (Excel)
فایل اکسل باید شامل 3 ستون باشد:
1. **ستون اول**: کیلومتراژ
2. **ستون دوم**: ارتفاع زمین
3. **ستون سوم**: ارتفاع جاده

### لایه‌ها
```json
{
  "id": 1,
  "name": "نام لایه",
  "thickness_cm": 20,
  "order_from_top": 1,
  "state": 1, // 0: متغیر, 1: ثابت
  "status": 2, // 0: شروع نشده, 1: در حال انجام, 2: تکمیل شده
  "experiments": [...]
}
```

### آزمایش‌ها
```json
{
  "id": 1,
  "kilometer_start": 30.5,
  "kilometer_end": 31.0,
  "experiment_type": "نوع آزمایش",
  "status": 2, // 0: در انتظار, 1: در حال انجام, 2: تکمیل شده, 3: رد شده
  "approval_status": 1, // 1: تایید شده
  "request_date": "2024/01/15",
  "description": "توضیحات"
}
```

## محدودیت‌ها

### محدودیت‌های لایه‌بندی
- لایه بالایی نمی‌تواند آزمایش داشته باشد تا زمانی که لایه پایینی تکمیل نشده است
- این محدودیت در داشبورد نمایش داده می‌شود

### محدودیت‌های نمایش
- حداکثر زوم: 5 برابر
- حداقل زوم: 0.1 برابر
- اندازه پیکسل آزمایش‌ها: 8x8 پیکسل

## فایل‌های مرتبط

### Backend
- `project/views.py`: ProjectDashboardView
- `project/models.py`: مدل‌های پروژه، لایه و ابنیه
- `experiment/models.py`: مدل‌های آزمایش

### Frontend
- `static/js/dashboard.js`: کلاس اصلی داشبورد
- `static/js/dashboard-utils.js`: توابع کمکی
- `static/css/dashboard.css`: استایل‌های داشبورد
- `project/templates/project/dashboard.html`: قالب HTML

### فایل‌های Canvas
- `static/js/canvas.js`: کلاس اصلی Canvas
- `static/js/landline.js`: رسم خط زمین
- `static/js/roadline.js`: رسم خط جاده
- `static/js/layerline.js`: رسم لایه‌ها
- `static/js/structure.js`: رسم ابنیه‌ها
- `static/js/xaxiscanvas.js`: محور X
- `static/js/yaxiscanvas.js`: محور Y

## عیب‌یابی

### مشکلات رایج

1. **نمودار نمایش داده نمی‌شود**
   - بررسی فایل پروفیل
   - بررسی داده‌های پروژه در دیتابیس

2. **آزمایش‌ها نمایش داده نمی‌شوند**
   - بررسی ارتباط لایه‌ها با آزمایش‌ها
   - بررسی وضعیت آزمایش‌ها

3. **عملکرد کند**
   - کاهش تعداد نقاط پروفیل
   - استفاده از debounce برای رویدادها

### لاگ‌ها
خطاها در کنسول مرورگر نمایش داده می‌شوند.

## توسعه

### اضافه کردن ویژگی جدید
1. اضافه کردن متد در `ProjectDashboard` کلاس
2. اضافه کردن کنترل در HTML
3. اضافه کردن استایل در CSS
4. تست عملکرد

### بهینه‌سازی
- استفاده از Web Workers برای محاسبات سنگین
- Lazy loading برای داده‌های بزرگ
- Caching برای بهبود عملکرد

## پشتیبانی

برای سوالات و مشکلات، لطفاً با تیم توسعه تماس بگیرید. 