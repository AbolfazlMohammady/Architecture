{% extends "base.html" %}
{% load static %}

{% block title %}جزئیات درخواست آزمایش{% endblock %}

{% block main %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">جزئیات درخواست آزمایش</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>پروژه</label>
                                <p class="form-control-static">{{ request.project.name }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>لایه</label>
                                <p class="form-control-static">{{ request.layer.layer_type.name }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>نوع آزمایش</label>
                                <p class="form-control-static">{{ request.experiment_type.name }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>زیرنوع آزمایش</label>
                                <p class="form-control-static">{{ request.experiment_subtype.name }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>محل بتن‌ریزی</label>
                                <p class="form-control-static">{{ request.concrete_place.name }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>تاریخ درخواست</label>
                                <p class="form-control-static">{{ request.request_date }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>کیلومتر شروع</label>
                                <p class="form-control-static">{{ request.start_kilometer }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>کیلومتر پایان</label>
                                <p class="form-control-static">{{ request.end_kilometer }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>توضیحات</label>
                                <p class="form-control-static">{{ request.description }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>دانسیته هدف</label>
                                <p class="form-control-static">{{ request.target_density }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>مقاومت هدف</label>
                                <p class="form-control-static">{{ request.target_strength }}</p>
                            </div>
                        </div>
                    </div>

                    {% if request.request_file %}
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>فایل درخواست</label>
                                <p class="form-control-static">
                                    <a href="{{ request.request_file.url }}" target="_blank">دانلود فایل</a>
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if request.experimentresponse %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h4 class="card-title">پاسخ آزمایش</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>پاسخ دهنده</label>
                                        <p class="form-control-static">{{ request.experimentresponse.responder.get_full_name }}</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>تاریخ پاسخ</label>
                                        <p class="form-control-static">{{ request.experimentresponse.response_date }}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>توضیحات پاسخ</label>
                                        <p class="form-control-static">{{ request.experimentresponse.description }}</p>
                                    </div>
                                </div>
                            </div>

                            {% if request.experimentresponse.response_file %}
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>فایل پاسخ</label>
                                        <p class="form-control-static">
                                            <a href="{{ request.experimentresponse.response_file.url }}" target="_blank">دانلود فایل</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    {% if request.experimentapproval %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h4 class="card-title">تایید آزمایش</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>تایید کننده</label>
                                        <p class="form-control-static">{{ request.experimentapproval.approver.get_full_name }}</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>تاریخ تایید</label>
                                        <p class="form-control-static">{{ request.experimentapproval.approval_date }}</p>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>وضعیت</label>
                                        <p class="form-control-static">
                                            {% if request.experimentapproval.status == 2 %}
                                            <span class="badge bg-success">تایید شده</span>
                                            {% else %}
                                            <span class="badge bg-danger">رد شده</span>
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>توضیحات تایید</label>
                                        <p class="form-control-static">{{ request.experimentapproval.description }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="row mt-4">
                        <div class="col-12">
                            <a href="{% url 'experiment:experiment_request_list' %}" class="btn btn-secondary">بازگشت به لیست</a>
                            {% if request.status == 0 %}
                            <a href="{% url 'experiment:experiment_response_create' request.pk %}" class="btn btn-primary">پاسخ</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 